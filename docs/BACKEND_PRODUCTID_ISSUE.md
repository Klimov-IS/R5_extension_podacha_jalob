# –¢–ó: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ productId –≤ Backend API

**–î–∞—Ç–∞:** 2026-01-29
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî• CRITICAL (–ë–õ–û–ö–ï–†)
**Endpoint:** `/api/extension/stores/:storeId/complaints`
**–í–µ—Ä—Å–∏—è API:** 2.0.0

---

## üö® –ü—Ä–æ–±–ª–µ–º–∞

Backend API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤ –ø–æ–ª–µ `productId` **–Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–¥–∞–≤—Ü–∞** –≤–º–µ—Å—Ç–æ **—á–∏—Å–ª–æ–≤–æ–≥–æ –∞—Ä—Ç–∏–∫—É–ª–∞ —Ç–æ–≤–∞—Ä–∞ Wildberries**.

–≠—Ç–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è, —Ç–∞–∫ –∫–∞–∫:
1. –ü–æ–∏—Å–∫ –ø–æ –∞—Ä—Ç–∏–∫—É–ª—É –Ω–∞ WB –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (WB –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç —Ç–æ–≤–∞—Ä –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é)
2. –ê–ª–≥–æ—Ä–∏—Ç–º —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–æ–≤ –ª–æ–º–∞–µ—Ç—Å—è (–∫–ª—é—á–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç)
3. –ñ–∞–ª–æ–±—ã –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è ‚ùå

---

## üìä –¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û)

### –ó–∞–ø—Ä–æ—Å:
```bash
curl -H "Authorization: Bearer wbrm_0ab7137430d4fb62948db3a7d9b4b997" \
  "http://158.160.217.236/api/extension/stores/7kKX9WgLvOPiXYIHk6hi/complaints?limit=5&filter=draft&rating=1,2,3"
```

### –û—Ç–≤–µ—Ç (—Ç–µ–∫—É—â–∏–π):
```json
{
  "complaints": [
    {
      "id": "MDZTXVilHWCXBK1YZx4u",
      "productId": "P-02-NY-long",  // ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –≠—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
      "rating": 1,
      "text": "–°–∞–º–∞—è –æ—Ç–≤—Ä–∞—Ç–∏—Ç–µ–ª—å–Ω–∞—è –ø–∏–∂–∞–º–∞...",
      "authorName": "–ê–ª–∏–Ω–∞",
      "createdAt": "2026-01-07T20:09:37.000Z",
      "complaintText": {
        "reasonId": 11,
        "reasonName": "–û—Ç–∑—ã–≤ –Ω–µ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ —Ç–æ–≤–∞—Ä—É",
        "complaintText": "–û—Ç–∑—ã–≤ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç..."
      }
    },
    {
      "id": "BuqKtsdHZzxAYevQz71K",
      "productId": "–§–ª–∏—Å–æ–≤—ã–µ –±—Ä—é–∫–∏ –∫–æ—Ä–∏—á–Ω–µ–≤—ã–µ –ù–õ",  // ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
      "rating": 3,
      ...
    },
    {
      "id": "RL8O41ysJ0URxiO8uEmW",
      "productId": "–ë—Ä—é–∫–∏ –≤ –ø–æ–ª–æ—Å–∫—É –≥–æ–ª—É–±—ã–µ",  // ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
      "rating": 2,
      ...
    },
    {
      "id": "E87L2vsIMAdErNoc2KUy",
      "productId": "shortbaze–≥–æ–ª—É–±–æ–π",  // ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
      "rating": 1,
      ...
    }
  ],
  "total": 5,
  "stats": {
    "by_article": {
      "shortbaze–≥–æ–ª—É–±–æ–π": 86,  // ‚ùå –≠—Ç–æ –≤—Å–µ –Ω–∞–∑–≤–∞–Ω–∏—è, –∞ –Ω–µ –∞—Ä—Ç–∏–∫—É–ª—ã
      "–ë—Ä—é–∫–∏ —Å–µ—Ä—ã–µ –ø–∏–∂–∞–º–Ω—ã–µ –∂–µ–Ω—Å–∫–∏–µ": 78,
      "shortbaze—á–µ—Ä–Ω—ã–µ": 71,
      ...
    }
  }
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `"P-02-NY-long"` - —ç—Ç–æ **–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–¥–∞–≤—Ü–∞**
- –ù–æ WB –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—á–∏—Å–ª–æ–≤–æ–π –∞—Ä—Ç–∏–∫—É–ª** —Ç–∏–ø–∞ `"187489568"` –∏–ª–∏ `"234567890"`

---

## ‚úÖ –¢—Ä–µ–±—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (–ü–†–ê–í–ò–õ–¨–ù–û)

### –û—Ç–≤–µ—Ç (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å):
```json
{
  "complaints": [
    {
      "id": "MDZTXVilHWCXBK1YZx4u",
      "productId": "187489568",  // ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ß–∏—Å–ª–æ–≤–æ–π –∞—Ä—Ç–∏–∫—É–ª WB
      "productName": "P-02-NY-long",  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –¥–ª—è UI/–æ—Ç–ª–∞–¥–∫–∏
      "rating": 1,
      "text": "–°–∞–º–∞—è –æ—Ç–≤—Ä–∞—Ç–∏—Ç–µ–ª—å–Ω–∞—è –ø–∏–∂–∞–º–∞...",
      "authorName": "–ê–ª–∏–Ω–∞",
      "createdAt": "2026-01-07T20:09:37.000Z",
      "complaintText": {
        "reasonId": 11,
        "reasonName": "–û—Ç–∑—ã–≤ –Ω–µ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ —Ç–æ–≤–∞—Ä—É",
        "complaintText": "–û—Ç–∑—ã–≤ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç..."
      }
    },
    {
      "id": "BuqKtsdHZzxAYevQz71K",
      "productId": "234567890",  // ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ß–∏—Å–ª–æ–≤–æ–π –∞—Ä—Ç–∏–∫—É–ª WB
      "productName": "–§–ª–∏—Å–æ–≤—ã–µ –±—Ä—é–∫–∏ –∫–æ—Ä–∏—á–Ω–µ–≤—ã–µ –ù–õ",
      "rating": 3,
      ...
    }
  ],
  "total": 5,
  "stats": {
    "by_article": {
      "187489568": 86,  // ‚úÖ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —á–∏—Å–ª–æ–≤—ã–º –∞—Ä—Ç–∏–∫—É–ª–∞–º
      "234567890": 78,
      "345678901": 71,
      ...
    }
  }
}
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
1. `productId` –î–û–õ–ñ–ï–ù –±—ã—Ç—å **—á–∏—Å–ª–æ–≤—ã–º –∞—Ä—Ç–∏–∫—É–ª–æ–º WB** (—Å—Ç—Ä–æ–∫–∞ –∏–∑ —Ü–∏—Ñ—Ä)
2. –§–æ—Ä–º–∞—Ç: `"187489568"` (string, —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã)
3. `productName` –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –æ—Ç–ª–∞–¥–∫–∏

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: –û—Ç–∫—É–¥–∞ –±–µ—Ä–µ—Ç—Å—è productId?

### –í–µ—Ä–æ—è—Ç–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ SQL –∑–∞–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç API. –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–¥–Ω–æ –∏–∑ —ç—Ç–∏—Ö –ø–æ–ª–µ–π:

```sql
SELECT
  rc.id,
  rc.product_id,           -- ‚ùì –ß—Ç–æ –∑–¥–µ—Å—å —Ö—Ä–∞–Ω–∏—Ç—Å—è?
  r.product_article,        -- ‚ùì –ò–ª–∏ –∑–¥–µ—Å—å –∞—Ä—Ç–∏–∫—É–ª WB?
  r.product_name,           -- ‚ùì –ò–ª–∏ —ç—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏–µ?
  r.product_sku,            -- ‚ùì –ò–ª–∏ SKU?
  r.nm_id,                  -- ‚ùì –ò–ª–∏ nm_id (–∞—Ä—Ç–∏–∫—É–ª WB)?
  p.wb_article,             -- ‚ùì –ò–ª–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã products?
  p.seller_article          -- ‚ùì –ò–ª–∏ –∞—Ä—Ç–∏–∫—É–ª –ø—Ä–æ–¥–∞–≤—Ü–∞?
FROM review_complaints rc
JOIN reviews r ON rc.review_id = r.id
LEFT JOIN products p ON r.product_id = p.id
WHERE rc.status = 'draft'
LIMIT 10;
```

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —ç—Ç–∏ –ø–æ–ª—è:

| –ü–æ–ª–µ | –ß—Ç–æ —Ç–∞–º —Å–µ–π—á–∞—Å? | –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è API? |
|------|-----------------|-------------------|
| `reviews.product_article` | ? | –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞—Ä—Ç–∏–∫—É–ª WB (—Ü–∏—Ñ—Ä—ã) |
| `reviews.product_name` | –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ | –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è productId |
| `reviews.nm_id` | ? | –í–æ–∑–º–æ–∂–Ω–æ, —ç—Ç–æ –∞—Ä—Ç–∏–∫—É–ª WB? |
| `products.wb_article` | ? | –í–æ–∑–º–æ–∂–Ω–æ, —ç—Ç–æ –∞—Ä—Ç–∏–∫—É–ª WB? |
| `products.seller_article` | –ê—Ä—Ç–∏–∫—É–ª –ø—Ä–æ–¥–∞–≤—Ü–∞ | –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è productId |

---

## üìù –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### 1. –ò–∑–º–µ–Ω–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π

**–§–∞–π–ª:** `src/routes/extension.ts` –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π

**–¢–µ–∫—É—â–∏–π –∫–æ–¥ (–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ):**
```typescript
const complaint = {
  id: rc.id,
  productId: review.product_name,  // ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
  rating: review.rating,
  ...
};
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥:**
```typescript
const complaint = {
  id: rc.id,
  productId: review.product_article || review.nm_id,  // ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –∞—Ä—Ç–∏–∫—É–ª WB
  productName: review.product_name,  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –¥–ª—è UI
  rating: review.rating,
  ...
};
```

### 2. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ productId

–î–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É, —á—Ç–æ `productId` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã:

```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
if (!/^\d+$/.test(complaint.productId)) {
  console.error(`Invalid productId format: "${complaint.productId}" (expected numeric string)`);
  // –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –Ω–∞–π—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞—Ä—Ç–∏–∫—É–ª –∏–∑ –¥—Ä—É–≥–∏—Ö –ø–æ–ª–µ–π
  complaint.productId = review.nm_id || review.product_article || 'UNKNOWN';
}
```

### 3. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É by_article

–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –≤ `stats.by_article` —Ç–æ–∂–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ —á–∏—Å–ª–æ–≤—ã–º –∞—Ä—Ç–∏–∫—É–ª–∞–º:

```typescript
// –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ productId (—á–∏—Å–ª–æ–≤–æ–π –∞—Ä—Ç–∏–∫—É–ª)
const statsByArticle = complaints.reduce((acc, c) => {
  const key = c.productId;  // ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º —á–∏—Å–ª–æ–≤–æ–π –∞—Ä—Ç–∏–∫—É–ª
  acc[key] = (acc[key] || 0) + 1;
  return acc;
}, {});
```

---

## üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –®–∞–≥ 1: –ó–∞–ø—Ä–æ—Å –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```bash
curl -H "Authorization: Bearer wbrm_0ab7137430d4fb62948db3a7d9b4b997" \
  "http://158.160.217.236/api/extension/stores/7kKX9WgLvOPiXYIHk6hi/complaints?limit=10&filter=draft&rating=1,2,3"
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç productId

–í—Å–µ `productId` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å **—Å—Ç—Ä–æ–∫–∞–º–∏ –∏–∑ —Ü–∏—Ñ—Ä**:

```bash
# –ó–∞–ø—Ä–æ—Å
curl -s -H "Authorization: Bearer wbrm_0ab7137430d4fb62948db3a7d9b4b997" \
  "http://158.160.217.236/api/extension/stores/7kKX9WgLvOPiXYIHk6hi/complaints?limit=100&filter=draft&rating=1,2,3" \
  | jq '.complaints[].productId'

# –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥ (–≤—Å–µ —á–∏—Å–ª–∞ –≤ –∫–∞–≤—ã—á–∫–∞—Ö):
"187489568"
"234567890"
"345678901"
...

# ‚ùå –ù–ï –î–û–õ–ñ–ù–û –ë–´–¢–¨:
"P-02-NY-long"
"–§–ª–∏—Å–æ–≤—ã–µ –±—Ä—é–∫–∏ –∫–æ—Ä–∏—á–Ω–µ–≤—ã–µ –ù–õ"
"shortbaze–≥–æ–ª—É–±–æ–π"
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Backend:

1. –û—Ç–∫—Ä—ã—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ ‚Üí "–ù–∞—á–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∂–∞–ª–æ–±"
2. –û—Ç–∫—Ä—ã—Ç—å DevTools Console
3. –ù–∞–π—Ç–∏ –±–ª–æ–∫ `=== üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê productId ===`
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–≤–æ–¥:

```
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ productId:
  ‚úÖ –ß–∏—Å–ª–æ–≤—ã—Ö –∞—Ä—Ç–∏–∫—É–ª–æ–≤ (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç): 200
  ‚ùå –ù–ï—á–∏—Å–ª–æ–≤—ã—Ö –∞—Ä—Ç–∏–∫—É–ª–æ–≤ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç): 0
```

**–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞:** –í—Å–µ productId —á–∏—Å–ª–æ–≤—ã–µ (0 –Ω–µ—á–∏—Å–ª–æ–≤—ã—Ö)

---

## üóÑÔ∏è SQL –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ó–∞–ø—Ä–æ—Å 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ

```sql
-- –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–∫—É–¥–∞ –±–µ—Ä–µ—Ç—Å—è productId
SELECT
  rc.id AS complaint_id,
  rc.product_id AS rc_product_id,
  r.id AS review_id,
  r.product_article,
  r.product_name,
  r.nm_id,
  r.product_sku
FROM review_complaints rc
JOIN reviews r ON rc.review_id = r.id
WHERE rc.status = 'draft'
LIMIT 20;
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞–∫–æ–µ –ø–æ–ª–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —á–∏—Å–ª–æ–≤–æ–π –∞—Ä—Ç–∏–∫—É–ª WB
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∞—Ä—Ç–∏–∫—É–ª WB –Ω–µ –ø—É—Å—Ç–æ–π –¥–ª—è –≤—Å–µ—Ö –æ—Ç–∑—ã–≤–æ–≤

### –ó–∞–ø—Ä–æ—Å 2: –ù–∞–π—Ç–∏ –æ—Ç–∑—ã–≤—ã –±–µ–∑ –∞—Ä—Ç–∏–∫—É–ª–∞ WB

```sql
-- –ù–∞–π—Ç–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –±–µ–∑ —á–∏—Å–ª–æ–≤–æ–≥–æ –∞—Ä—Ç–∏–∫—É–ª–∞
SELECT
  rc.id AS complaint_id,
  r.product_article,
  r.product_name,
  r.nm_id,
  CASE
    WHEN r.product_article ~ '^\d+$' THEN 'OK'
    WHEN r.nm_id ~ '^\d+$' THEN 'OK (use nm_id)'
    ELSE 'MISSING'
  END AS status
FROM review_complaints rc
JOIN reviews r ON rc.review_id = r.id
WHERE rc.status = 'draft'
  AND NOT (r.product_article ~ '^\d+$' OR r.nm_id ~ '^\d+$')
LIMIT 50;
```

**–ï—Å–ª–∏ –µ—Å—Ç—å –∑–∞–ø–∏—Å–∏:** –ù—É–∂–Ω–æ –ø–æ–Ω—è—Ç—å –æ—Ç–∫—É–¥–∞ –≤–∑—è—Ç—å –∞—Ä—Ç–∏–∫—É–ª WB –¥–ª—è —ç—Ç–∏—Ö –æ—Ç–∑—ã–≤–æ–≤

### –ó–∞–ø—Ä–æ—Å 3: –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

```sql
-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è –∞—Ä—Ç–∏–∫—É–ª–∞–º–∏
SELECT
  COUNT(*) AS total_complaints,
  COUNT(CASE WHEN r.product_article ~ '^\d+$' THEN 1 END) AS has_product_article,
  COUNT(CASE WHEN r.nm_id ~ '^\d+$' THEN 1 END) AS has_nm_id,
  COUNT(CASE WHEN r.product_name IS NOT NULL THEN 1 END) AS has_product_name
FROM review_complaints rc
JOIN reviews r ON rc.review_id = r.id
WHERE rc.status = 'draft';
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
total_complaints | has_product_article | has_nm_id | has_product_name
-----------------|---------------------|-----------|------------------
601              | 601                 | 601       | 601
```

(–í—Å–µ –∑–∞–ø–∏—Å–∏ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å —á–∏—Å–ª–æ–≤–æ–π –∞—Ä—Ç–∏–∫—É–ª)

---

## üìã –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è Backend —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

- [ ] –ò–∑—É—á–∏–ª –ø—Ä–æ–±–ª–µ–º—É: `productId` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–º–µ—Å—Ç–æ –∞—Ä—Ç–∏–∫—É–ª–∞
- [ ] –ó–∞–ø—É—Å—Ç–∏–ª SQL –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É (3 –∑–∞–ø—Ä–æ—Å–∞ –≤—ã—à–µ)
- [ ] –û–ø—Ä–µ–¥–µ–ª–∏–ª –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ –¥–ª—è –∞—Ä—Ç–∏–∫—É–ª–∞ WB (`product_article` –∏–ª–∏ `nm_id`?)
- [ ] –ò–∑–º–µ–Ω–∏–ª –º–∞–ø–ø–∏–Ω–≥ –≤ API endpoint `/api/extension/stores/:storeId/complaints`
- [ ] –î–æ–±–∞–≤–∏–ª –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ñ–æ—Ä–º–∞—Ç–∞ `productId` (—Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã)
- [ ] –û–±–Ω–æ–≤–∏–ª –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É –≤ `stats.by_article` (–ø–æ —á–∏—Å–ª–æ–≤—ã–º –∞—Ä—Ç–∏–∫—É–ª–∞–º)
- [ ] –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –¥–æ–±–∞–≤–∏–ª –ø–æ–ª–µ `productName` –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª –ª–æ–∫–∞–ª—å–Ω–æ: –≤—Å–µ `productId` —á–∏—Å–ª–æ–≤—ã–µ
- [ ] –ó–∞–¥–µ–ø–ª–æ–∏–ª –Ω–∞ production
- [ ] –ó–∞–ø—É—Å—Ç–∏–ª –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π curl –∑–∞–ø—Ä–æ—Å (—Å–º. —Ä–∞–∑–¥–µ–ª "–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å")
- [ ] –ü–æ–¥—Ç–≤–µ—Ä–¥–∏–ª Frontend –∫–æ–º–∞–Ω–¥–µ —á—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ

---

## üîß –ü—Ä–∏–º–µ—Ä –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–ø—Å–µ–≤–¥–æ–∫–æ–¥)

### –î–æ (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):

```typescript
// src/routes/extension.ts (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥)
export async function getComplaints(req, res) {
  const complaints = await db.query(`
    SELECT
      rc.id,
      r.product_name AS product_id,  -- ‚ùå –û–®–ò–ë–ö–ê: –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ
      r.rating,
      r.text,
      r.author_name,
      r.created_at,
      rc.complaint_text
    FROM review_complaints rc
    JOIN reviews r ON rc.review_id = r.id
    WHERE rc.status = $1
  `, ['draft']);

  return res.json({
    complaints: complaints.rows,
    total: complaints.rowCount
  });
}
```

### –ü–æ—Å–ª–µ (–ü–†–ê–í–ò–õ–¨–ù–û):

```typescript
// src/routes/extension.ts (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥)
export async function getComplaints(req, res) {
  const complaints = await db.query(`
    SELECT
      rc.id,
      COALESCE(r.product_article, r.nm_id) AS product_id,  -- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞—Ä—Ç–∏–∫—É–ª WB
      r.product_name,  -- ‚úÖ –î–æ–±–∞–≤–ª—è–µ–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
      r.rating,
      r.text,
      r.author_name,
      r.created_at,
      rc.complaint_text
    FROM review_complaints rc
    JOIN reviews r ON rc.review_id = r.id
    WHERE rc.status = $1
  `, ['draft']);

  // ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ productId
  const validatedComplaints = complaints.rows.map(c => {
    if (!c.product_id || !/^\d+$/.test(c.product_id)) {
      console.error(`Invalid productId for complaint ${c.id}: "${c.product_id}"`);
      // –ú–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—è –∏–ª–∏ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å
    }
    return c;
  });

  // ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —á–∏—Å–ª–æ–≤—ã–º –∞—Ä—Ç–∏–∫—É–ª–∞–º
  const statsByArticle = validatedComplaints.reduce((acc, c) => {
    if (c.product_id && /^\d+$/.test(c.product_id)) {
      acc[c.product_id] = (acc[c.product_id] || 0) + 1;
    }
    return acc;
  }, {});

  return res.json({
    complaints: validatedComplaints,
    total: validatedComplaints.length,
    stats: {
      by_article: statsByArticle
    }
  });
}
```

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

**Frontend:** –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [TESTING_PLAN.md](./TESTING_PLAN.md) - –ø–æ–ª–Ω—ã–π –ø–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
**Endpoint:** `POST /api/extension/stores/:storeId/complaints`

---

## ‚è±Ô∏è –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–∞–º–∫–∏

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** 1-2 —á–∞—Å–∞
- 15 –º–∏–Ω—É—Ç: SQL –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
- 30 –º–∏–Ω—É—Ç: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–∞–ø–ø–∏–Ω–≥–∞ + –≤–∞–ª–∏–¥–∞—Ü–∏—è
- 15 –º–∏–Ω—É—Ç: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ
- 30 –º–∏–Ω—É—Ç: –î–µ–ø–ª–æ–π + –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ production

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî• CRITICAL - –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –≤—Å–µ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è!

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏

1. ‚úÖ –í—Å–µ `productId` –≤ –æ—Ç–≤–µ—Ç–µ API - —Å—Ç—Ä–æ–∫–∏ –∏–∑ —Ü–∏—Ñ—Ä (—Ñ–æ—Ä–º–∞—Ç `"187489568"`)
2. ‚úÖ –ù–µ—Ç `productId` —Å –±—É–∫–≤–∞–º–∏ –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ —Ç–æ–≤–∞—Ä–æ–≤
3. ‚úÖ `stats.by_article` –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –ø–æ —á–∏—Å–ª–æ–≤—ã–º –∞—Ä—Ç–∏–∫—É–ª–∞–º
4. ‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0 –Ω–µ—á–∏—Å–ª–æ–≤—ã—Ö productId
5. ‚úÖ –¢–µ—Å—Ç—ã –∏–∑ TESTING_PLAN.md –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ

**–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ ‚Üí Frontend –∫–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å—Ç–∏—Ç –ø–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ—Ä–∫—Ñ–ª–æ—É**
