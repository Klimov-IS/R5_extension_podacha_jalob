# Testing Plan: Status Sync

> **–ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å—Ç–∞—Ç—É—Å–æ–≤**

---

## –≠—Ç–∞–ø—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –≠—Ç–∞–ø 1: Unit-—Ç–µ—Å—Ç—ã (–∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ)

#### 1.1 –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ - –ø–∞—Ä—Å–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–æ–≤

| –¢–µ—Å—Ç | –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç | –°—Ç–∞—Ç—É—Å |
|------|---------------------|--------|
| –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–æ–≤ –∏–∑ Chips | –ú–∞—Å—Å–∏–≤ —Å—Ç–∞—Ç—É—Å–æ–≤ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ canSubmitComplaint | true/false | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è reviewKey | –ö–ª—é—á –±–µ–∑ —Å–µ–∫—É–Ω–¥ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ payload | –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON | ‚è≥ –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å |

#### 1.2 Backend - API endpoint

| –¢–µ—Å—Ç | –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç | –°—Ç–∞—Ç—É—Å |
|------|---------------------|--------|
| –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö | 400 –ø—Ä–∏ –æ—à–∏–±–∫–µ | ‚è≥ Backend |
| –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î | –î–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∞–Ω—ã | ‚è≥ Backend |
| UPSERT –ª–æ–≥–∏–∫–∞ | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö | ‚è≥ Backend |
| –û—Ç–≤–µ—Ç API | 200 + —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | ‚è≥ Backend |

---

### –≠—Ç–∞–ø 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

#### 2.1 –¢–µ—Å—Ç: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ ‚Üí Backend

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
1. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø–∞—Ä—Å–∏—Ç 20 –æ—Ç–∑—ã–≤–æ–≤
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ Backend API
3. Backend —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î
4. –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –ë–î

**–ö–æ–Ω—Å–æ–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è —Ç–µ—Å—Ç–∞:**

```javascript
// –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –æ—Ç–∑—ã–≤–æ–≤ WB
(async () => {
  console.log('üß™ –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ ‚Üí Backend\n');

  // 1. –ü–∞—Ä—Å–∏–º –æ—Ç–∑—ã–≤—ã
  const table = document.querySelector('.Base-table-body__F-y98zdE6m');
  const rows = Array.from(table.querySelectorAll('[class*="table-row"]')).slice(0, 20);

  const reviews = [];
  for (const row of rows) {
    const data = window.DataExtractor.extractReviewData(row, '123456');
    if (data) {
      reviews.push({
        reviewKey: data.key.replace(/T(\d{2}:\d{2}):\d{2}\.\d{3}Z$/, 'T$1'),
        productId: data.productId,
        rating: data.rating,
        reviewDate: data.reviewDate,
        statuses: data.statuses || [],
        canSubmitComplaint: !data.statuses.some(s =>
          ['–ñ–∞–ª–æ–±–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞', '–ñ–∞–ª–æ–±–∞ –æ–¥–æ–±—Ä–µ–Ω–∞', '–ü—Ä–æ–≤–µ—Ä—è–µ–º –∂–∞–ª–æ–±—É', '–ñ–∞–ª–æ–±–∞ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ–Ω–∞'].includes(s)
        )
      });
    }
  }

  console.log(`üìä –°–ø–∞—Ä—Å–µ–Ω–æ –æ—Ç–∑—ã–≤–æ–≤: ${reviews.length}`);
  console.log('üìã –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö:', reviews[0]);

  // 2. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Backend
  const payload = {
    storeId: 'test-store-123',
    parsedAt: new Date().toISOString(),
    reviews
  };

  console.log('\nüì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Backend...');
  console.log('Payload size:', JSON.stringify(payload).length, 'bytes');

  // –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–≥–¥–∞ Backend –≥–æ—Ç–æ–≤:
  // const response = await fetch('https://api.example.com/api/extension/review-statuses', {
  //   method: 'POST',
  //   headers: { 'Content-Type': 'application/json' },
  //   body: JSON.stringify(payload)
  // });
  // console.log('Response:', await response.json());

  console.log('\n‚úÖ –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à—ë–Ω (Backend –ø–æ–∫–∞ –Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω)');
})();
```

#### 2.2 –¢–µ—Å—Ç: Backend ‚Üí –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
1. –í –ë–î –µ—Å—Ç—å –æ—Ç–∑—ã–≤—ã —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏
2. Backend –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ—Ç–∑—ã–≤—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∂–∞–ª–æ–±
3. –û—Ç–∑—ã–≤—ã —Å `can_submit_complaint = false` –∏—Å–∫–ª—é—á–µ–Ω—ã

**SQL –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**

```sql
-- –°–∫–æ–ª—å–∫–æ –æ—Ç–∑—ã–≤–æ–≤ –º–æ–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å
SELECT
  COUNT(*) FILTER (WHERE can_submit_complaint = true) as can_process,
  COUNT(*) FILTER (WHERE can_submit_complaint = false) as cannot_process,
  COUNT(*) as total
FROM review_statuses_from_extension
WHERE store_id = 'test-store-123';

-- –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ~20% can_process, ~80% cannot_process
```

---

### –≠—Ç–∞–ø 3: End-to-End —Ç–µ—Å—Ç—ã

#### 3.1 –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª

```
[–û—Ç–∫—Ä—ã—Ç—å WB] ‚Üí [–ü–∞—Ä—Å–∏–Ω–≥] ‚Üí [–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Backend] ‚Üí [–ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î] ‚Üí [–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∂–∞–ª–æ–±] ‚Üí [–ü–æ–¥–∞—á–∞]
```

**–ß–µ–∫–ª–∏—Å—Ç:**

- [ ] –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø–∞—Ä—Å–∏—Ç —Å—Ç–∞—Ç—É—Å—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ Backend
- [ ] Backend —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ
- [ ] –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- [ ] –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –∂–∞–ª–æ–±—ã
- [ ] –ü–æ–¥–∞—á–∞ –∂–∞–ª–æ–± —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

### –ü—Ä–∏–º–µ—Ä payload –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```json
{
  "storeId": "test-store-123",
  "parsedAt": "2026-02-01T12:00:00.000Z",
  "reviews": [
    {
      "reviewKey": "649502497_1_2026-01-07T20:09",
      "productId": "649502497",
      "rating": 1,
      "reviewDate": "2026-01-07T20:09:37.000Z",
      "statuses": ["–ñ–∞–ª–æ–±–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞", "–í—ã–∫—É–ø"],
      "canSubmitComplaint": false
    },
    {
      "reviewKey": "528735233_2_2026-01-15T14:30",
      "productId": "528735233",
      "rating": 2,
      "reviewDate": "2026-01-15T14:30:00.000Z",
      "statuses": ["–í—ã–∫—É–ø"],
      "canSubmitComplaint": true
    },
    {
      "reviewKey": "187489568_1_2026-01-20T09:15",
      "productId": "187489568",
      "rating": 1,
      "reviewDate": "2026-01-20T09:15:00.000Z",
      "statuses": ["–ü—Ä–æ–≤–µ—Ä—è–µ–º –∂–∞–ª–æ–±—É", "–û—Ç–∫–∞–∑"],
      "canSubmitComplaint": false
    }
  ]
}
```

---

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏

### –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –ü–æ—Ä–æ–≥ |
|----------|-------|
| –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–æ–≤ | 100% —Ç–æ—á–Ω–æ—Å—Ç—å |
| –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ canSubmitComplaint | 100% —Ç–æ—á–Ω–æ—Å—Ç—å |
| –£—Å–ø–µ—à–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ | >95% –∑–∞–ø—Ä–æ—Å–æ–≤ |
| –í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ | <2 —Å–µ–∫ –Ω–∞ 100 –æ—Ç–∑—ã–≤–æ–≤ |

### Backend

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –ü–æ—Ä–æ–≥ |
|----------|-------|
| –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö | 100% |
| UPSERT –±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ | 100% |
| –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API | <500ms |
| –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ | 100% —Ç–æ—á–Ω–æ—Å—Ç—å |

### –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –¶–µ–ª—å |
|---------|-----|-------|------|
| –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∂–∞–ª–æ–± GPT | 100% | ~20% | -80% —Ç–æ–∫–µ–Ω–æ–≤ |
| –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –ø–æ–¥–∞—á–∏ | ~20% | >80% | –ú–µ–Ω—å—à–µ –æ—Ç–∫–∞–∑–æ–≤ |

---

## –û—Ç—á—ë—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

### –®–∞–±–ª–æ–Ω –æ—Ç—á—ë—Ç–∞

```markdown
## –û—Ç—á—ë—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ Status Sync

**–î–∞—Ç–∞:** ___
**–í–µ—Ä—Å–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è:** ___
**–í–µ—Ä—Å–∏—è Backend:** ___

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

| –¢–µ—Å—Ç | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------|--------|-------------|
| –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–æ–≤ | ‚úÖ/‚ùå | |
| –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Backend | ‚úÖ/‚ùå | |
| –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î | ‚úÖ/‚ùå | |
| –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è | ‚úÖ/‚ùå | |

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –æ—Ç–∑—ã–≤–æ–≤: ___
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: ___
- –û—à–∏–±–æ–∫: ___

### –ü—Ä–æ–±–ª–µ–º—ã

1. ...
2. ...

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. ...
2. ...
```

---

## Timeline

| –ù–µ–¥–µ–ª—è | –ó–∞–¥–∞—á–∞ | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π |
|--------|--------|---------------|
| 1 | Backend: API + –ë–î | Backend |
| 1 | –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ: StatusSyncService | Extension |
| 2 | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã | –û–±–µ –∫–æ–º–∞–Ω–¥—ã |
| 2 | E2E —Ç–µ—Å—Ç—ã | –û–±–µ –∫–æ–º–∞–Ω–¥—ã |
| 3 | –ü—Ä–æ–¥–∞–∫—à–Ω | –û–±–µ –∫–æ–º–∞–Ω–¥—ã |
